{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\HP\\\\Desktop\\\\WEB DEV\\\\Reactjs\\\\chatting_app\\\\src\\\\Components\\\\Search.js\",\n  _s = $RefreshSig$();\nimport React, { useContext, useState } from 'react';\nimport { collection, query, where, getDoc, setDoc, updateDoc, doc } from \"firebase/firestore\";\nimport { db } from '../Firebase';\nimport { AuthContext } from '../context/AuthenticationContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Search = () => {\n  _s();\n  const [username, setUsername] = useState(\"\"); // used to change directly input entered by user\n  const [user, setUser] = useState(null); //if username is found, then that user is set to 'user' state\n  const [error, setError] = useState(false);\n  const {\n    currentUser\n  } = useContext(AuthContext);\n  const handleSearch = async () => {\n    const userRef = collection(db, \"users\");\n\n    // Create a query against the collection.\n    const q = query(userRef, where(\"displayName\", \"==\", username));\n    try {\n      const querySnapshot = await getDocs(q);\n      querySnapshot.forEach(doc => {\n        setUser(doc.data());\n      });\n    } catch (error) {\n      setError(true);\n    }\n  };\n  const handleKey = e => {\n    e.code === \"Enter\" && handleSearch();\n  };\n  const handleSelect = async () => {\n    // check whether the collection of chat (chats in firestore) exists, if not create it.\n    const combinedID = currentUser.uid > user.uid ? currentUser.uid + user.uid : user.uid + currentUser.uid;\n    try {\n      const res = await getDoc(doc(db, \"chatsCollection\", combinedID));\n      if (!res.exists()) {\n        // this is a firebase method\n        // need to create a chat in chat collection\n        await setDoc(doc(db, 'chatsCollection', combinedID), {\n          messages: []\n        });\n\n        // create user chats here\n\n        // userChats:{\n        //   tuv:{\n        //     combinedID:{\n        //       userInfo{\n        //         disableNetwork, img, id\n        //       },\n        //       lastMesaage:\"\",\n        //       date:\n        //     }\n        //   }\n        // }\n\n        await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n          [combinedID + \".userInfo\"]: {\n            uid: user.uid,\n            displayName: user.displayName,\n            photoURL: user.photoURL\n          },\n          [combinedID + \".date\"]: serverTimestamp()\n        });\n\n        // another user\n\n        await updateDoc(doc(db, \"userChats\", user.uid), {\n          [combinedID + \".userInfo\"]: {\n            uid: currentUser.uid,\n            displayName: currentUser.displayName,\n            photoURL: currentUser.photoURL\n          },\n          [combinedID + \".date\"]: serverTimestamp()\n        });\n      }\n    } catch (error) {}\n\n    //create user chats\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"search\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"search-form\",\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Find the person\",\n        onKeyDown: handleKey,\n        onChange: e => setUsername(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"span\", {\n      children: \"User Not found\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 17\n    }, this), user && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"user-chat\",\n      onClick: handleSelect,\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: user.photoURL,\n        alt: \"chat-image\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"userChat-info\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: user.displayName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 10\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 16\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 5\n  }, this);\n};\n_s(Search, \"eJAgq3e933d/rGBWujbXybOol9M=\");\n_c = Search;\nexport default Search;\nvar _c;\n$RefreshReg$(_c, \"Search\");","map":{"version":3,"names":["React","useContext","useState","collection","query","where","getDoc","setDoc","updateDoc","doc","db","AuthContext","jsxDEV","_jsxDEV","Search","_s","username","setUsername","user","setUser","error","setError","currentUser","handleSearch","userRef","q","querySnapshot","getDocs","forEach","data","handleKey","e","code","handleSelect","combinedID","uid","res","exists","messages","displayName","photoURL","serverTimestamp","className","children","type","placeholder","onKeyDown","onChange","target","value","fileName","_jsxFileName","lineNumber","columnNumber","onClick","src","alt","_c","$RefreshReg$"],"sources":["C:/Users/HP/Desktop/WEB DEV/Reactjs/chatting_app/src/Components/Search.js"],"sourcesContent":["import React, { useContext, useState } from 'react';\r\nimport { collection, query, where, getDoc, setDoc, updateDoc, doc } from \"firebase/firestore\";\r\nimport {db} from '../Firebase';\r\nimport { AuthContext } from '../context/AuthenticationContext';\r\n\r\nconst Search = () => {\r\n\r\n  const [username, setUsername] = useState(\"\");  // used to change directly input entered by user\r\n  const [user, setUser] = useState(null);   //if username is found, then that user is set to 'user' state\r\n  const [error, setError] = useState(false);\r\n  const {currentUser} = useContext(AuthContext);\r\n\r\n  const handleSearch = async() => {\r\n    const userRef = collection(db, \"users\");\r\n\r\n    // Create a query against the collection.\r\n    const q = query(userRef, where(\"displayName\", \"==\", username));\r\n\r\n    try{\r\n      const querySnapshot = await getDocs(q);\r\n      querySnapshot.forEach((doc) => {\r\n      setUser(doc.data())\r\n    });\r\n    }catch(error){\r\n      setError(true);\r\n    }\r\n  };\r\n\r\n  const handleKey = (e) =>{\r\n     e.code === \"Enter\" && handleSearch();\r\n  };\r\n\r\n  const handleSelect = async() =>{\r\n    // check whether the collection of chat (chats in firestore) exists, if not create it.\r\n    const combinedID = currentUser.uid > user.uid ? \r\n                       currentUser.uid + user.uid : \r\n                      user.uid + currentUser.uid;\r\n    try{\r\n      const res = await getDoc(doc(db,\"chatsCollection\", combinedID));\r\n\r\n      if(!res.exists()){  // this is a firebase method\r\n        // need to create a chat in chat collection\r\n        await setDoc(doc(db, 'chatsCollection', combinedID), {messages:[]});\r\n\r\n        // create user chats here\r\n\r\n        // userChats:{\r\n        //   tuv:{\r\n        //     combinedID:{\r\n        //       userInfo{\r\n        //         disableNetwork, img, id\r\n        //       },\r\n        //       lastMesaage:\"\",\r\n        //       date:\r\n        //     }\r\n        //   }\r\n        // }\r\n\r\n            await updateDoc(doc(db, \"userChats\", currentUser.uid),{\r\n              [combinedID+\".userInfo\"]:{\r\n                uid:user.uid,\r\n                displayName: user.displayName,\r\n                photoURL: user.photoURL              \r\n              },\r\n              [combinedID+\".date\"]:serverTimestamp()\r\n            });\r\n\r\n            // another user\r\n\r\n            await updateDoc(doc(db, \"userChats\", user.uid),{\r\n              [combinedID+\".userInfo\"]:{\r\n                uid:currentUser.uid,\r\n                displayName: currentUser.displayName,\r\n                photoURL: currentUser.photoURL              \r\n              },\r\n              [combinedID+\".date\"]:serverTimestamp()\r\n            });\r\n\r\n      }\r\n    }catch(error){\r\n\r\n    }\r\n    \r\n    //create user chats\r\n  }\r\n\r\n  return (\r\n    <div className='search'>\r\n      <div className='search-form'>\r\n        <input type='text' placeholder='Find the person' onKeyDown={handleKey} onChange={e=>setUsername(e.target.value)}></input>\r\n      </div>\r\n      {error && <span>User Not found</span>}\r\n      {user && <div className='user-chat' onClick={handleSelect}>\r\n        <img src={user.photoURL}\r\n         alt='chat-image'/>\r\n         <div className='userChat-info'>\r\n            <span>{user.displayName}</span>\r\n         </div>\r\n      </div>}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Search;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}