{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\HP\\\\Desktop\\\\WEB DEV\\\\Reactjs\\\\chatting_app\\\\src\\\\Components\\\\Search.js\",\n  _s = $RefreshSig$();\nimport React, { useContext, useState } from 'react';\nimport { collection, query, where, getDoc, getDocs, serverTimestamp, setDoc, updateDoc, doc } from \"firebase/firestore\";\nimport { db } from '../Firebase';\nimport { AuthContext } from '../context/AuthenticationContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Search = () => {\n  _s();\n  const [username, setUsername] = useState(\"\"); // used to change directly input entered by user\n  const [user, setUser] = useState(null); //if username is found, then that user is set to 'user' state\n  const [error, setError] = useState(false);\n  const {\n    currentUser\n  } = useContext(AuthContext);\n  const handleSearch = async () => {\n    const userRef = collection(db, \"users\");\n\n    // Create a query against the collection.\n    const q = query(userRef, where(\"displayName\", \"==\", username));\n    try {\n      const querySnapshot = await getDocs(q);\n      querySnapshot.forEach(doc => {\n        setUser(doc.data());\n      });\n    } catch (error) {\n      setError(true);\n    }\n  };\n  const handleKey = e => {\n    e.code === \"Enter\" && handleSearch();\n  };\n  const handleSelect = async () => {\n    // check whether the collection of chat (chats in firestore) exists, if not create it.\n    const combinedID = currentUser.uid > user.uid ? currentUser.uid + user.uid : user.uid + currentUser.uid;\n    try {\n      const res = await getDoc(doc(db, \"chatsCollection\", combinedID));\n      if (!res.exists()) {\n        // this is a firebase method\n        // need to create a chat in chat collection\n        await setDoc(doc(db, 'chatsCollection', combinedID), {\n          messages: []\n        });\n\n        // create user chats here\n\n        // userChats:{\n        //   tuv:{\n        //     combinedID:{\n        //       userInfo{\n        //         disableNetwork, img, id\n        //       },\n        //       lastMesaage:\"\",\n        //       date:\n        //     }\n        //   }\n        // }\n\n        await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n          [combinedID + \".userInfo\"]: {\n            uid: user.uid,\n            displayName: user.displayName,\n            photoURL: user.photoURL\n          },\n          [combinedID + \".date\"]: serverTimestamp()\n        });\n\n        // another user\n\n        await updateDoc(doc(db, \"userChats\", user.uid), {\n          [combinedID + \".userInfo\"]: {\n            uid: currentUser.uid,\n            displayName: currentUser.displayName,\n            photoURL: currentUser.photoURL\n          },\n          [combinedID + \".date\"]: serverTimestamp()\n        });\n      }\n    } catch (error) {}\n    setUser(null);\n    setUsername('');\n    //create user chats\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"search\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"search-form\",\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Find the person\",\n        onKeyDown: handleKey,\n        onChange: e => setUsername(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"span\", {\n      children: \"User Not found\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 17\n    }, this), user && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"user-chat\",\n      onClick: handleSelect,\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: user.photoURL,\n        alt: \"chat-image\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"userChat-info\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: user.displayName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 10\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 16\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 5\n  }, this);\n};\n_s(Search, \"eJAgq3e933d/rGBWujbXybOol9M=\");\n_c = Search;\nexport default Search;\nvar _c;\n$RefreshReg$(_c, \"Search\");","map":{"version":3,"names":["React","useContext","useState","collection","query","where","getDoc","getDocs","serverTimestamp","setDoc","updateDoc","doc","db","AuthContext","jsxDEV","_jsxDEV","Search","_s","username","setUsername","user","setUser","error","setError","currentUser","handleSearch","userRef","q","querySnapshot","forEach","data","handleKey","e","code","handleSelect","combinedID","uid","res","exists","messages","displayName","photoURL","className","children","type","placeholder","onKeyDown","onChange","target","value","fileName","_jsxFileName","lineNumber","columnNumber","onClick","src","alt","_c","$RefreshReg$"],"sources":["C:/Users/HP/Desktop/WEB DEV/Reactjs/chatting_app/src/Components/Search.js"],"sourcesContent":["import React, { useContext, useState } from 'react';\r\nimport { collection, query, where, getDoc, getDocs, serverTimestamp, setDoc, updateDoc, doc } from \"firebase/firestore\";\r\nimport {db} from '../Firebase';\r\nimport { AuthContext } from '../context/AuthenticationContext';\r\n\r\nconst Search = () => {\r\n\r\n  const [username, setUsername] = useState(\"\");  // used to change directly input entered by user\r\n  const [user, setUser] = useState(null);   //if username is found, then that user is set to 'user' state\r\n  const [error, setError] = useState(false);\r\n  const {currentUser} = useContext(AuthContext);\r\n\r\n  const handleSearch = async() => {\r\n    const userRef = collection(db, \"users\");\r\n\r\n    // Create a query against the collection.\r\n    const q = query(userRef, where(\"displayName\", \"==\", username));\r\n\r\n    try{\r\n      const querySnapshot = await getDocs(q);\r\n      querySnapshot.forEach((doc) => {\r\n      setUser(doc.data())\r\n    });\r\n    }catch(error){\r\n      setError(true);\r\n    }\r\n  };\r\n\r\n  const handleKey = (e) =>{\r\n     e.code === \"Enter\" && handleSearch();\r\n  };\r\n\r\n  const handleSelect = async() =>{\r\n    // check whether the collection of chat (chats in firestore) exists, if not create it.\r\n    const combinedID = currentUser.uid > user.uid ? \r\n                       currentUser.uid + user.uid : \r\n                      user.uid + currentUser.uid;\r\n    try{\r\n      const res = await getDoc(doc(db,\"chatsCollection\", combinedID));\r\n\r\n      if(!res.exists()){  // this is a firebase method\r\n        // need to create a chat in chat collection\r\n        await setDoc(doc(db, 'chatsCollection', combinedID), {messages:[]});\r\n\r\n        // create user chats here\r\n\r\n        // userChats:{\r\n        //   tuv:{\r\n        //     combinedID:{\r\n        //       userInfo{\r\n        //         disableNetwork, img, id\r\n        //       },\r\n        //       lastMesaage:\"\",\r\n        //       date:\r\n        //     }\r\n        //   }\r\n        // }\r\n\r\n            await updateDoc(doc(db, \"userChats\", currentUser.uid),{\r\n              [combinedID+\".userInfo\"]:{\r\n                uid:user.uid,\r\n                displayName: user.displayName,\r\n                photoURL: user.photoURL              \r\n              },\r\n              [combinedID+\".date\"]:serverTimestamp()\r\n            });\r\n\r\n            // another user\r\n\r\n            await updateDoc(doc(db, \"userChats\", user.uid),{\r\n              [combinedID+\".userInfo\"]:{\r\n                uid:currentUser.uid,\r\n                displayName: currentUser.displayName,\r\n                photoURL: currentUser.photoURL              \r\n              },\r\n              [combinedID+\".date\"]:serverTimestamp()\r\n            });\r\n\r\n      }\r\n    }catch(error){\r\n\r\n    }\r\n    setUser(null);\r\n    setUsername('');\r\n    //create user chats\r\n  }\r\n\r\n  return (\r\n    <div className='search'>\r\n      <div className='search-form'>\r\n        <input type='text' placeholder='Find the person' onKeyDown={handleKey} onChange={e=>setUsername(e.target.value)}></input>\r\n      </div>\r\n      {error && <span>User Not found</span>}\r\n      {user && <div className='user-chat' onClick={handleSelect}>\r\n        <img src={user.photoURL}\r\n         alt='chat-image'/>\r\n         <div className='userChat-info'>\r\n            <span>{user.displayName}</span>\r\n         </div>\r\n      </div>}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Search;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}